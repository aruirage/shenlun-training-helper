<!-- pages/full-train/index.wxml - é‡æ„ç‰ˆï¼šæ‰‹å†™æ”¯æ¶å¼ä½œæ–‡è®­ç»ƒ -->
<view class="full-train-container">
  <!-- å·¦ä¾§å¯¼èˆªæ  -->
  <view class="full-train-nav">
    <view class="nav-header">
      <view class="nav-logo">ç¬”</view>
      <view class="nav-title">ç”³è®º AI åŠ©æ‰‹</view>
    </view>
    <view class="nav-menu">
      <view 
        wx:for="{{navItems}}" 
        wx:key="name"
        class="nav-item {{activeNav === item.name ? 'active' : ''}}"
        data-name="{{item.name}}"
        data-route="{{item.route}}"
        bindtap="onNavItemTap"
      >{{item.name}}</view>
    </view>
  </view>

  <!-- ä¸­é—´ä¸»å†…å®¹åŒº -->
  <view class="full-train-main">
    <view class="content-wrapper">
      <!-- é¢˜ç›®å¡ç‰‡ -->
      <view class="essay-card">
        <view class="card-header">
          <view class="chips-row">
            <text class="chip chip-primary">{{essay.year}}</text>
            <text class="chip chip-warning">{{essay.paperType}}</text>
          </view>
        </view>

        <view class="card-body">
          <view class="essay-title">{{essay.title}}</view>
        </view>

        <view class="card-footer">
          <input 
            type="text"
            class="main-thesis-input"
            placeholder="è¯·ç”¨ä¸€å¥è¯æ¦‚æ‹¬ä½ çš„æ€»è®ºç‚¹..."
            value="{{mainArgument}}"
            bindinput="onMainArgumentInput" />
        </view>
      </view>

      <!-- åˆ†è®ºç‚¹å†™ä½œåŒº -->
      <view class="sections-panel">
        <view class="sections-header">
          <text class="sections-title">âœï¸ åˆ†è®ºç‚¹å†™ä½œ</text>
          <text class="sections-count">{{completedCount}}/{{sections.length}}</text>
        </view>

        <view class="sections-list">
          <view class="section-card" wx:for="{{sections}}" wx:key="id">
            <!-- å¤´éƒ¨ï¼šåºå· + æ ‡é¢˜è¾“å…¥ -->
            <view class="section-header">
              <text class="section-number">{{index + 1}}</text>
              <input 
                class="section-title-input"
                placeholder="åˆ†è®ºç‚¹ {{index + 1}}ï¼šè¾“å…¥æ ¸å¿ƒè§‚ç‚¹..."
                value="{{item.title}}"
                data-id="{{item.id}}"
                bindinput="onSectionTitleInput" />
              <!-- çœ¼ç›æŒ‰é’®éšè—/æ˜¾ç¤ºæç¤º -->
              <view class="section-peek-btn {{item.showTip ? '' : 'peeking'}}" data-id="{{item.id}}" bindtap="toggleSectionTip">
                {{item.showTip ? 'ğŸ‘ï¸' : 'âœ“'}}
              </view>
            </view>

            <!-- å†™ä½œæ”¯æ¶æç¤º -->
            <view class="section-scaffolds" wx:if="{{item.showTip}}">
              <view class="scaffold-tags">
                <text class="scaffold-tag">é¢†åŸŸï¼š{{item.macroField}}</text>
                <text class="scaffold-tag">æ–¹å‘ï¼š{{item.policyDirection}}</text>
              </view>
              <view class="scaffold-structure">
                <text class="structure-label">æ®µè½éª¨æ¶ï¼š</text>
                <text class="structure-text">{{item.structureHint}}</text>
                <button class="structure-switch" bindtap="switchStructureHint" data-id="{{item.id}}">æ¢ä¸€å¥—</button>
              </view>
            </view>

            <!-- æ®µè½è¾“å…¥æ¡† -->
            <textarea 
              class="section-textarea"
              placeholder="åœ¨è¿™é‡Œå†™è¿™ä¸€æ®µç”³è®ºå†…å®¹..."
              value="{{item.content}}"
              data-id="{{item.id}}"
              bindinput="onSectionInput"
              maxlength="800" />
            
            <view class="section-actions">
              <button class="btn btn-secondary" data-id="{{item.id}}" bindtap="saveSection">
                ğŸ’¾ ä¿å­˜æœ¬æ®µ
              </button>
              <button class="btn btn-primary" data-id="{{item.id}}" bindtap="completeSection">
                âœ“ å®Œæˆæœ¬æ®µ
              </button>
            </view>

            <!-- åº•éƒ¨æ“ä½œåŒº -->
            <view class="section-footer">
              <text class="char-count">{{item.content.length}}/800</text>
              <button 
                class="collect-snippet-btn" 
                bindtap="collectCommentSnippet" 
                data-section-id="{{item.id}}"
                wx:if="{{item.content.length > 10}}">
                â­ æ”¶è—ç²¾å½©ç‰‡æ®µ
              </button>
            </view>
          </view>
        </view>

        <view class="train-actions">
          <button class="btn btn-secondary" bindtap="previewFullEssay">é¢„è§ˆå…¨æ–‡</button>
          <button class="btn btn-primary" bindtap="submitAiComment">æäº¤AIç‚¹è¯„</button>
        </view>
      </view>
    </view>
  </view>

  <!-- å³ä¾§ææ–™åŒº -->
  <view class="full-train-right {{showRightPanel ? '' : 'collapsed'}}" style="width: {{showRightPanel ? rightPanelWidth : 0}}px;">
    <!-- è°ƒæ•´æ‰‹æŸ„ -->
    <view 
      class="resize-handle" 
      catchtouchstart="startResize"
      catchtouchmove="onResize"
      catchtouchend="endResize">
      <view class="resize-line"></view>
    </view>
    
    <!-- éšè—æŒ‰é’® -->
    <view class="panel-toggle-btn" bindtap="toggleRightPanel">
      <text class="toggle-icon">{{showRightPanel ? 'â€º' : 'â€¹'}}</text>
    </view>
    
    <view class="material-panel">
      <view class="material-header">
        <text class="material-title">ğŸ“„ é¢˜ç›®ææ–™</text>
        <view class="material-tools">
          <button class="tool-btn-icon {{drawMode ? 'active' : ''}}" bindtap="toggleDrawMode">
            {{drawMode ? 'âœ“' : 'âœ'}}
          </button>
          <button class="tool-btn-icon" bindtap="collectEventMaterial">â­</button>
        </view>
      </view>
      
      <view class="material-content">
        <!-- ææ–™æ–‡æœ¬ -->
        <view class="material-text">{{essay.materialSummary}}</view>
        
        <!-- æ‰‹å†™å‹¾ç”»å±‚ï¼ˆé¢„ç•™ï¼‰ -->
        <view wx:if="{{drawMode}}" class="material-overlay-canvas">
          <text class="canvas-placeholder">æ‰‹å†™å‹¾ç”»åŠŸèƒ½ï¼ˆCanvas é¢„ç•™åŒºåŸŸï¼‰</text>
        </view>
      </view>
    </view>
  </view>
  
</view>
