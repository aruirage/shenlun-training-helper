<!-- pages/full-train/index.wxml -->
<view class="full-train-container">
  <!-- å·¦ä¾§å¯¼èˆªæ  -->
  <view class="full-train-nav">
    <view class="nav-header">
      <view class="nav-logo">ç¬”</view>
      <view class="nav-title">ç”³è®º AI åŠ©æ‰‹</view>
    </view>
    <view class="nav-menu">
      <view class="nav-item" bindtap="navigateTo" data-page="/pages/home/index">é¦–é¡µ</view>
      <view class="nav-item" bindtap="navigateTo" data-page="/pages/hot-list/index">ä»Šæ—¥çƒ­ç‚¹</view>
      <view class="nav-item active">å¤§ä½œæ–‡è®­ç»ƒ</view>
      <view class="nav-item" bindtap="navigateTo" data-page="/pages/materials/index">ç´ æåº“</view>
      <view class="nav-item" bindtap="navigateTo" data-page="/pages/memory/index">èƒŒè¯µæœ¬</view>
      <view class="nav-item">è®¾ç½®</view>
    </view>
  </view>

  <!-- ä¸­é—´ä¸»å†…å®¹åŒº -->
  <main class="full-train-main">
    <view class="content-wrapper">
      <!-- é¢˜ç›®å¡ç‰‡ -->
      <view class="essay-card">
        <view class="card-header">
          <view class="chips-row">
            <text class="chip chip-primary">{{essay.year}}</text>
            <text class="chip chip-warning">{{essay.paperType}}</text>
          </view>
        </view>

        <view class="card-body">
          <view class="essay-title">{{essay.title}}</view>

          <view class="essay-material-section">
            <text class="material-text line-clamp-2">{{essay.materialSummary}}</text>
            <button class="expand-btn" bindtap="toggleMaterial">å±•å¼€å®Œæ•´ææ–™ âŒ„</button>
          </view>
        </view>

        <view class="card-footer">
          <input 
            type="text"
            class="main-thesis-input"
            placeholder="è¯·ç”¨ä¸€å¥è¯æ¦‚æ‹¬ä½ çš„æ€»è®ºç‚¹..."
            value="{{mainArgument}}"
            bindinput="onMainArgumentInput" />
          <button class="ai-recommend-btn" bindtap="recommendMainArgument">âœ¨ AI æ¨èä¸»è®ºç‚¹</button>
        </view>
      </view>

      <!-- åˆ†è®ºç‚¹æ§½ä½åˆ—è¡¨ -->
      <view class="slots-section">
        <view class="slots-label">ç»“æ„å¸ƒå±€ ({{completedSlots}}/{{argumentSlots.length}})</view>

        <view class="slot-card" wx:for="{{argumentSlots}}" wx:key="id">
          <!-- æ§½ä½æ ‡é¢˜ä¸æ ‡ç­¾ -->
          <view class="slot-header">
            <view class="slot-title-area">
              <input 
                type="text"
                class="slot-title-input"
                placeholder="åˆ†è®ºç‚¹ {{index + 1}}ï¼šè¯·è¾“å…¥æ ¸å¿ƒè§‚ç‚¹"
                value="{{item.title}}"
                bindinput="onSlotTitleInput"
                data-index="{{index}}" />
              <view class="tags-row">
                <text class="tag">{{item.macroField}}</text>
                <text class="tag">{{item.policyDirection}}</text>
                <button class="tag-add">+</button>
              </view>
            </view>
          </view>

          <!-- ç´ æå¼•ç”¨åŒº -->
          <view class="slot-materials-area">
            <view class="material-chips-row">
              <view class="material-chip" wx:for="{{item.selectedMaterials}}" wx:key="id" wx:for-item="m">
                <text class="chip-icon">ğŸ“–</text>
                <text class="chip-text">{{m.content.substring(0, 10)}}...</text>
                <text class="chip-remove" catchtap="removeMaterialFromSlot" data-slot-index="{{index}}" data-id="{{m.id}}">âœ•</text>
              </view>
            </view>
            <button class="add-material-btn" bindtap="selectMaterials" data-index="{{index}}">+ ä»ç´ æåº“é€‰ç´ æ</button>
          </view>

          <!-- æ®µè½ç¼–è¾‘åŒº -->
          <textarea 
            class="paragraph-textarea"
            placeholder="åœ¨æ­¤å¤„æ’°å†™è¯¥åˆ†è®ºç‚¹æ®µè½å†…å®¹..."
            value="{{item.paragraph}}"
            bindinput="onParagraphInput"
            data-index="{{index}}" />

          <!-- å¡ç‰‡åº•æ  -->
          <view class="slot-actions">
            <button class="btn-outline" bindtap="addToLibrary" data-index="{{index}}">ğŸ’¾ åŠ å…¥ç´ æåº“</button>
            <button class="btn-outline primary" bindtap="generateParagraph" data-index="{{index}}">âœ¨ AI ç”Ÿæˆæœ¬æ®µ</button>
          </view>
        </view>

        <!-- å¢åŠ åˆ†è®ºç‚¹æŒ‰é’® -->
        <button class="add-slot-btn" bindtap="addSlot">+ å¢åŠ åˆ†è®ºç‚¹æ§½ä½</button>
      </view>
    </view>

    <!-- åº•éƒ¨å›ºå®šå·¥å…·æ  -->
    <view class="bottom-toolbar">
      <view class="toolbar-stats">
        <view class="stat-item">
          <text class="stat-dot"></text>
          <text class="stat-text">å·²å®Œæˆ {{completedCount}} / {{argumentSlots.length}} æ®µ</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-sub">é¢„è®¡å­—æ•°ï¼š{{wordCount}} / 1200</text>
        </view>
      </view>
      <button class="btn-generate" bindtap="generateFullDraft">ğŸ“¤ ç”Ÿæˆå…¨æ–‡è‰ç¨¿</button>
    </view>
  </main>

  <!-- å³ä¾§ç´ æä¾§æ  -->
  <aside class="full-train-sidebar {{isMaterialSidebarOpen ? 'open' : ''}}">
    <!-- ä¾§æ å¤´éƒ¨ -->
    <view class="sidebar-header">
      <view class="sidebar-title">ğŸ“š é€‰æ‹©åº“ä¸­ç´ æ</view>
      <button class="sidebar-close" bindtap="closeMaterialSidebar">âœ•</button>
    </view>

    <!-- ç­›é€‰åŒº -->
    <view class="sidebar-filters">
      <button class="filter-btn active">å…¨éƒ¨</button>
      <button class="filter-btn">é‡‘å¥</button>
      <button class="filter-btn">æ¡ˆä¾‹</button>
      <button class="filter-btn">å¥å¼</button>
    </view>

    <!-- æœç´¢æ¡† -->
    <view class="sidebar-search">
      <input 
        type="text"
        class="search-input"
        placeholder="æœç´¢é¢†åŸŸæˆ–å…³é”®è¯..." />
    </view>

    <!-- ç´ æåˆ—è¡¨ -->
    <view class="sidebar-list">
      <view class="material-item" wx:for="{{libraryMaterials}}" wx:key="id">
        <view class="material-top">
          <text class="material-type">{{item.type}}</text>
          <view class="material-checkbox {{item.checked ? 'checked' : ''}}" bindtap="toggleSlotMaterial" data-id="{{item.id}}">
            {{item.checked ? 'âœ“' : ''}}
          </view>
        </view>
        <view class="material-content">{{item.content}}</view>
        <view class="material-source">{{item.source}}</view>
      </view>
    </view>

    <!-- ä¾§æ åº•éƒ¨ -->
    <view class="sidebar-footer">
      <button class="btn-confirm" bindtap="confirmMaterials">ç¡®è®¤åŠ å…¥å½“å‰åˆ†è®ºç‚¹</button>
    </view>
  </aside>
</view>
