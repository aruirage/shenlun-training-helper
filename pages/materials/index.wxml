<!-- pages/materials/index.wxml - React Minimalist Materials Design -->

<view class="materials-root">
  <!-- iPad ä¸‰æ å¸ƒå±€ -->
  <view wx:if="{{isPad}}" class="materials-layout">
    
    <!-- å·¦ä¾§å¯¼èˆªæ  -->
    <view class="materials-nav">
      <view class="nav-header">
        <view class="nav-icon">ğŸ“š</view>
        <text class="nav-title">ç´ æåº“ç›®å½•</text>
      </view>
      
      <view class="nav-tree">
        <view class="nav-group">
          <view class="nav-group-header" bindtap="toggleNavItem" data-name="æ°‘ç”Ÿæ²»ç†">
            <text class="nav-group-title">æ°‘ç”Ÿæ²»ç†</text>
            <text class="nav-expand-icon">{{expandedNavItems.includes('æ°‘ç”Ÿæ²»ç†') ? 'â–¼' : 'â–¶'}}</text>
          </view>
          <view class="nav-group-children" wx:if="{{expandedNavItems.includes('æ°‘ç”Ÿæ²»ç†')}}">
            <view class="nav-child {{selectedPolicy === 'ä¹¡æ‘æŒ¯å…´' ? 'active' : ''}}" bindtap="onPolicyTap" data-policy="ä¹¡æ‘æŒ¯å…´">ä¹¡æ‘æŒ¯å…´</view>
            <view class="nav-child {{selectedPolicy === 'å…±åŒå¯Œè£•' ? 'active' : ''}}" bindtap="onPolicyTap" data-policy="å…±åŒå¯Œè£•">å…±åŒå¯Œè£•</view>
            <view class="nav-child {{selectedPolicy === 'ç¤¾ä¼šæ²»ç†' ? 'active' : ''}}" bindtap="onPolicyTap" data-policy="ç¤¾ä¼šæ²»ç†">ç¤¾ä¼šæ²»ç†</view>
          </view>
        </view>

        <view class="nav-group">
          <view class="nav-group-header" bindtap="toggleNavItem" data-name="ç§‘æŠ€åˆ›æ–°">
            <text class="nav-group-title">ç§‘æŠ€åˆ›æ–°</text>
            <text class="nav-expand-icon">{{expandedNavItems.includes('ç§‘æŠ€åˆ›æ–°') ? 'â–¼' : 'â–¶'}}</text>
          </view>
          <view class="nav-group-children" wx:if="{{expandedNavItems.includes('ç§‘æŠ€åˆ›æ–°')}}">
            <view class="nav-child {{selectedPolicy === 'æ•°å­—ä¸­å›½' ? 'active' : ''}}" bindtap="onPolicyTap" data-policy="æ•°å­—ä¸­å›½">æ•°å­—ä¸­å›½</view>
            <view class="nav-child {{selectedPolicy === 'äººå·¥æ™ºèƒ½' ? 'active' : ''}}" bindtap="onPolicyTap" data-policy="äººå·¥æ™ºèƒ½">äººå·¥æ™ºèƒ½</view>
            <view class="nav-child {{selectedPolicy === 'å¤§å›½é‡å™¨' ? 'active' : ''}}" bindtap="onPolicyTap" data-policy="å¤§å›½é‡å™¨">å¤§å›½é‡å™¨</view>
          </view>
        </view>

        <view class="nav-group">
          <view class="nav-group-header" bindtap="toggleNavItem" data-name="ç”Ÿæ€ç¯å¢ƒ">
            <text class="nav-group-title">ç”Ÿæ€ç¯å¢ƒ</text>
            <text class="nav-expand-icon">{{expandedNavItems.includes('ç”Ÿæ€ç¯å¢ƒ') ? 'â–¼' : 'â–¶'}}</text>
          </view>
          <view class="nav-group-children" wx:if="{{expandedNavItems.includes('ç”Ÿæ€ç¯å¢ƒ')}}">
            <view class="nav-child {{selectedPolicy === 'ç»¿è‰²å‘å±•' ? 'active' : ''}}" bindtap="onPolicyTap" data-policy="ç»¿è‰²å‘å±•">ç»¿è‰²å‘å±•</view>
            <view class="nav-child {{selectedPolicy === 'ç¢³è¾¾å³°' ? 'active' : ''}}" bindtap="onPolicyTap" data-policy="ç¢³è¾¾å³°">ç¢³è¾¾å³°</view>
            <view class="nav-child {{selectedPolicy === 'ç¾ä¸½ä¸­å›½' ? 'active' : ''}}" bindtap="onPolicyTap" data-policy="ç¾ä¸½ä¸­å›½">ç¾ä¸½ä¸­å›½</view>
          </view>
        </view>
      </view>
    </view>

    <!-- ä¸­é—´åˆ—è¡¨åŒº -->
    <view class="materials-main">
      <!-- é¡¶éƒ¨å¤´éƒ¨ -->
      <view class="materials-header">
        <view class="header-top">
          <text class="header-title">ç´ ææµè§ˆ</text>
          <view class="search-box">
            <text class="search-icon">ğŸ”</text>
            <input type="text" class="search-input" placeholder="æœç´¢å…³é”®è¯..." value="{{searchKeyword}}" bindinput="onSearchInput" />
          </view>
        </view>

        <!-- è¿‡æ»¤ Chips -->
        <view class="filter-chips">
          <view class="chip" wx:for="{{selectedChips}}" wx:key="*this">
            {{item}}
            <text class="chip-close" bindtap="removeChip" data-value="{{item}}">Ã—</text>
          </view>
        </view>

        <!-- ç±»å‹ Tabs -->
        <view class="type-tabs">
          <view class="tab-item {{currentTypeIndex === index ? 'active' : ''}}" wx:for="{{typeList}}" wx:key="index" bindtap="onTypeChange" data-index="{{index}}">
            {{item}}
          </view>
        </view>
      </view>

      <!-- å¡ç‰‡åˆ—è¡¨ -->
      <view class="materials-list">
        <view class="material-card {{selectedMaterial && selectedMaterial._id === item._id ? 'selected' : ''}}" 
              wx:for="{{filteredMaterials}}" wx:key="_id" 
              bindtap="onMaterialTap" data-id="{{item._id}}">
          <view class="card-header">
            <text class="card-title">{{item.sourceTitle}}</text>
            <text class="card-badge" style="color: {{item.typeColor}}; background-color: {{item.typeBg}};">{{item.typeLabel}}</text>
          </view>
          <view class="card-content">{{item.content}}</view>
          <view class="card-footer">
            <view class="card-meta">
              <text class="meta-source">{{item.sourceName}}</text>
              <text class="meta-date">{{item.sourceDate}}</text>
            </view>
            <view class="card-tag">{{item.policyDirection}}</view>
          </view>
        </view>

        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty-state" wx:if="{{filteredMaterials.length === 0 && !isLoading}}">
          <text class="empty-icon">ğŸ“„</text>
          <text class="empty-text">æš‚æ— æ­¤ç±»ç´ æ</text>
        </view>
      </view>
    </view>

  </view>

  <!-- æ‰‹æœºå•æ å¸ƒå±€ -->
  <view wx:else class="phone-layout">
    <view class="phone-header">
      <text class="phone-title">ç´ ææµè§ˆ</text>
      <view class="search-box">
        <text class="search-icon">ğŸ”</text>
        <input type="text" class="search-input" placeholder="æœç´¢å…³é”®è¯..." value="{{searchKeyword}}" bindinput="onSearchInput" />
      </view>
    </view>

    <view class="filter-chips">
      <view class="chip" wx:for="{{selectedChips}}" wx:key="*this">
        {{item}}
        <text class="chip-close" bindtap="removeChip" data-value="{{item}}">Ã—</text>
      </view>
    </view>

    <view class="type-tabs">
      <view class="tab-item {{currentTypeIndex === index ? 'active' : ''}}" wx:for="{{typeList}}" wx:key="index" bindtap="onTypeChange" data-index="{{index}}">
        {{item}}
      </view>
    </view>

    <view class="materials-list">
      <view class="material-card" wx:for="{{filteredMaterials}}" wx:key="_id" bindtap="onMaterialTap" data-id="{{item._id}}">
        <view class="card-header">
          <text class="card-title">{{item.sourceTitle}}</text>
          <text class="card-badge" style="color: {{item.typeColor}}; background-color: {{item.typeBg}};">{{item.typeLabel}}</text>
        </view>
        <view class="card-content">{{item.content}}</view>
        <view class="card-footer">
          <view class="card-meta">
            <text class="meta-source">{{item.sourceName}}</text>
            <text class="meta-date">{{item.sourceDate}}</text>
          </view>
          <view class="card-tag">{{item.policyDirection}}</view>
        </view>
      </view>
    </view>
  </view>
</view>
