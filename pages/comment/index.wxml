<!-- pages/comment/index.wxml -->
<view class="comment-container">
  <!-- å·¦ä¾§å¯¼èˆªæ  -->
  <aside class="comment-nav">
    <view class="nav-header">
      <view class="nav-logo">ç¬”</view>
      <view class="nav-title">ç”³è®º AI åŠ©æ‰‹</view>
    </view>
    <nav class="nav-menu">
      <view class="nav-item">é¦–é¡µ</view>
      <view class="nav-item">ä»Šæ—¥çƒ­ç‚¹</view>
      <view class="nav-item">å¤§ä½œæ–‡è®­ç»ƒ</view>
      <view class="nav-item">ç´ æåº“</view>
      <view class="nav-item">èƒŒè¯µæœ¬</view>
      <view class="nav-item">è®¾ç½®</view>
    </nav>
  </aside>

  <!-- ä¸­é—´ä¸»å†…å®¹åŒº -->
  <main class="comment-main">
    <view class="content-inner">
      <!-- æ ‡é¢˜ -->
      <view class="page-header">
        <view class="page-title">
          <text class="title-bar"></text>
          <text class="title-text">AIçƒ­ç‚¹åˆ†è®ºç‚¹ç‚¹è¯„</text>
        </view>
        <view class="page-meta">ç”Ÿæˆæ—¶é—´ï¼š2025-12-26 14:30</view>
      </view>

      <!-- AI æ€»è¯„å¡ç‰‡ -->
      <view class="evaluation-card">
        <view class="card-top">
          <view class="grade-section">
            <view class="grade-badge">A</view>
            <view class="grade-info">
              <view class="grade-title">ç»¼åˆè¯„çº§ï¼šä¼˜ç§€</view>
              <view class="grade-subtitle">æœ¬æ¬¡ä¹ ä½œå±•ç°äº†æ·±åšçš„è¯­è¨€åŠŸåº•ï¼Œå»ºè®®åœ¨ç»“æ„æ·±åº¦ä¸Šè¿›ä¸€æ­¥æ¢ç´¢ã€‚</view>
            </view>
          </view>

          <!-- ç»´åº¦è¯„åˆ† -->
          <view class="dimensions-grid">
            <view class="dimension-box" wx:for="{{dimensions}}" wx:key="name">
              <view class="dimension-label">{{item.name}}</view>
              <view class="dimension-score">
                <view class="score-value">{{item.score === 85 ? 'A' : item.score === 90 ? 'A' : item.score === 82 ? 'B' : 'A'}}</view>
              </view>
              <view class="dimension-comment">{{item.comment}}</view>
            </view>
          </view>
        </view>

        <!-- åˆ†è®ºç‚¹åé¦ˆ -->
        <view class="feedback-section">
          <view class="section-label">åˆ†è®ºç‚¹æ·±åº¦è¯„ä»·</view>
          <view class="feedback-list">
            <view class="feedback-item" wx:for="{{viewpointFeedback}}" wx:key="title">
              <view class="feedback-status {{item.score >= 85 ? 'status-excellent' : item.score >= 80 ? 'status-good' : 'status-fair'}}">
                {{item.score >= 85 ? 'ä¼˜' : item.score >= 80 ? 'å¹³' : 'ç¼º'}}
              </view>
              <view class="feedback-content">
                <view class="feedback-title">{{item.title}}</view>
                <view class="feedback-comment">{{item.comment}}</view>
              </view>
              <view class="feedback-arrow">â€º</view>
            </view>
          </view>
        </view>
      </view>

      <!-- è¯„è®ºå‚è€ƒä¸æ¨èç´ æ -->
      <view class="reference-section">
        <view wx:if="{{!referenceExpanded}}" class="expand-placeholder" bindtap="toggleReference">
          <view class="expand-icon">âŒ„</view>
          <view class="expand-text">æŸ¥çœ‹å®˜æ–¹è¯„è®ºå‚è€ƒä¸æ¨èç´ æ</view>
        </view>

        <view wx:if="{{referenceExpanded}}" class="expanded-content">
          <!-- è¯„è®ºæ ¸å¿ƒåˆ†è®ºç‚¹ -->
          <view class="reference-subsection">
            <view class="subsection-title">
              <text class="title-icon">ğŸ“ˆ</text>
              <text class="title-text">è¯„è®ºæ ¸å¿ƒåˆ†è®ºç‚¹å‚è€ƒ</text>
            </view>
            <view class="viewpoints-grid">
              <view class="viewpoint-card" wx:for="{{referenceViewpoints}}" wx:key="title">
                <view class="viewpoint-header">
                  <view class="viewpoint-title">{{item.title}}</view>
                  <view class="match-badge {{item.match === 'é«˜åº¦ä¸€è‡´' ? 'match-high' : item.match === 'éƒ¨åˆ†è¦†ç›–' ? 'match-medium' : 'match-low'}}">
                    {{item.match}}
                  </view>
                </view>
                <view class="viewpoint-desc">{{item.explanation}}</view>
              </view>
            </view>
          </view>

          <!-- æ¨èç´ æ -->
          <view class="reference-subsection">
            <view class="subsection-title">
              <text class="title-icon">ğŸ“š</text>
              <text class="title-text">é’ˆå¯¹æ€§è¡¥å¼ºç´ ææ¨è</text>
            </view>
            <view class="materials-list">
              <view class="material-item {{item.selected ? 'selected' : ''}}" wx:for="{{recommendedMaterials}}" wx:key="id" bindtap="selectMaterial" data-id="{{item.id}}">
                <view class="material-checkbox" catchtap="toggleMaterial" data-id="{{item.id}}">
                  <text wx:if="{{item.selected}}">âœ“</text>
                </view>
                <view class="material-main">
                  <view class="material-header">
                    <view class="chip {{item.typeClass}}">{{item.type}}</view>
                    <view class="material-date">{{item.date}}</view>
                  </view>
                  <view class="material-text">{{item.content}}</view>
                  <view class="material-meta">
                    <text class="meta-source">{{item.source}}</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨å·¥å…·æ  -->
    <view class="bottom-toolbar" wx:if="{{referenceExpanded}}">
      <view class="toolbar-content">
        <view class="selected-info">
          <text class="check-icon">âœ“</text>
          <text class="selected-text">å·²é€‰ <text class="count">{{selectedCount}}</text> æ¡ç´ æ</text>
        </view>
        <button class="btn-add" bindtap="addToLibrary">åŠ å…¥æˆ‘çš„ç´ æåº“</button>
      </view>
    </view>
  </main>

  <!-- å³ä¾§è¯¦æƒ…æ ï¼ˆiPadå±•ç¤ºï¼‰ -->
  <aside class="comment-aside" wx:if="{{selectedMaterial}}">
    <view class="aside-header">
      <view class="chip {{selectedMaterial.typeClass}}">{{selectedMaterial.type}}</view>
      <view class="aside-date">{{selectedMaterial.date}}</view>
    </view>

    <view class="aside-title">ç´ æè¯¦æƒ…</view>

    <view class="aside-quote">"{{selectedMaterial.content}}"</view>

    <view class="aside-meta">
      <view class="meta-row">
        <text class="meta-label">æ¥æº</text>
        <text class="meta-value">{{selectedMaterial.source}}</text>
      </view>
    </view>

    <view class="aside-tip">
      <text class="tip-icon">âœ¨</text>
      <view class="tip-content">
        <view class="tip-label">ä½¿ç”¨å»ºè®®</view>
        <view class="tip-text">è¯¥ç´ æé€‚åˆç”¨äºæ–‡ç« åˆ†è®ºç‚¹å¼€å¤´ï¼Œä½œä¸ºæ•°å­—åŒ–ä¸æ°‘ç”Ÿè¿æ¥ç‚¹çš„è®ºè¯æ”¯æ’‘ã€‚</view>
      </view>
    </view>

    <button class="btn-bookmark" bindtap="addToMemoryFromSelected">ğŸ”– åŠ å…¥èƒŒè¯µæœ¬</button>
    <button class="btn-link" bindtap="openSourceLink">ğŸ”— æŸ¥çœ‹åŸæ–‡å‡ºå¤„</button>
  </aside>

  <!-- ç©ºçŠ¶æ€ï¼ˆiPad æœªé€‰æ‹©æ—¶ï¼‰ -->
  <aside class="comment-aside empty" wx:if="{{!selectedMaterial && isPad}}">
    <view class="empty-icon">ğŸ“„</view>
    <view class="empty-title">æš‚æœªé€‰æ‹©ç´ æ</view>
    <view class="empty-text">ç‚¹å‡»å·¦ä¾§æ¨èåˆ—è¡¨ä¸­çš„å¡ç‰‡<br/>æŸ¥çœ‹è¯¦ç»†è§£æä¸ä½¿ç”¨æŒ‡å¯¼</view>
  </aside>
</view>
