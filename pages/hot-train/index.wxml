<view class="container">
  <!-- ä¾§è¾¹å¯¼èˆªæ  (Global Sidebar) -->
  <sidebar-nav activeNav="çƒ­ç‚¹è®­ç»ƒ" userAvatar="{{userAvatar}}"></sidebar-nav>

  <!-- ä¸»å†…å®¹åŒº -->
  <view class="main-wrapper">
    <!-- Header -->
    <header class="editor-header">
      <view class="header-left">
        <view class="back-btn" bindtap="goBack">
          <text class="icon-chevron-left">ã€ˆ</text>
        </view>
        <view class="divider-v"></view>
        <view class="status-info">
          <text class="zap-icon">âš¡</text>
          <text class="status-label">æ­£åœ¨è¿›è¡Œï¼š</text>
          <text class="status-text">{{statusTitle}}</text>
        </view>
        <view class="badge-training">åˆ†è®ºç‚¹è®­ç»ƒ</view>
      </view>
      <view class="header-right">
        <!-- æŒ‰é’®å·²ç§»è‡³ä¸‹æ–¹ -->
      </view>
    </header>

    <view class="content-body">
      <!-- Left: Context / Reference -->
      <aside class="context-sidebar">
        <view class="context-header">
          <text class="context-title">æ¨èç´ æ</text>
          <view class="badge-outline">2 æ¡</view>
        </view>
        <scroll-view scroll-y class="context-scroll">
          <view class="material-cards">
            <view class="material-card" wx:for="{{recommendedMaterials}}" wx:key="index">
              <view class="card-tag">
                <text class="tag-dot {{item.type === 'é‡‘å¥' ? 'amber' : 'emerald'}}"></text>
                <text class="tag-label">{{item.type}}</text>
              </view>
              <view class="card-content">
                <text class="serif-text">{{item.content}}</text>
              </view>
            </view>
          </view>
        </scroll-view>
      </aside>

      <!-- Middle: Writing IDE -->
      <main class="writing-ide">
        <view class="ide-container">
          <view class="ide-header">
            <view class="topic-title">çƒ­ç‚¹ï¼š{{topicTitle}}</view>
            <view class="goal-text">ç›®æ ‡ï¼š{{goalText}}</view>
          </view>

          <!-- ç”³è®ºé¢˜ç›®ä¸ AI ææ–™ -->
          <view class="material-preview-section">
            <view class="material-preview">
              <text class="material-title">{{question}}</text>
              <button class="material-more" bindtap="toggleMaterialFull">
                {{showFullMaterial ? 'æ”¶èµ·ææ–™' : 'å±•å¼€ AI ææ–™'}}
              </button>
            </view>

            <scroll-view
              wx:if="{{showFullMaterial}}"
              scroll-y="true"
              class="material-full"
            >
              <view class="ai-material-header">
                <text class="ai-material-title">ğŸ“„ AI ç¼–å†™ææ–™</text>
              </view>
              <text class="full-material-text">{{material}}</text>
            </scroll-view>
          </view>

          <view class="tabs-container">
            <view class="tabs-list">
              <view 
                class="tab-trigger {{activeTabIndex === index ? 'active' : ''}}" 
                wx:for="{{tabs}}" 
                wx:key="index"
                bindtap="onTabTap"
                data-index="{{index}}"
              >
                {{item}}
              </view>
            </view>
            
            <view class="editor-wrapper">
              <textarea 
                class="writing-textarea" 
                placeholder="å¦‚ï¼šæ•°å­—åŒ–èµ‹èƒ½ä¹¡æ‘æ²»ç†ï¼Œæå‡å…¬å…±æœåŠ¡è§¦è¾¾æ•ˆç‡â€¦â€¦" 
                value="{{currentParagraph}}"
                bindinput="onInput"
                maxlength="1000"
                placeholder-class="textarea-placeholder"
              ></textarea>
              
              <view class="editor-actions">
                <text class="word-count">å·²è¾“å…¥ {{wordCount}} å­—</text>
                <view class="actions-column">
                  <view class="btn-outline-sm finish-btn" bindtap="finishParagraph">å®Œæˆæœ¬æ®µ</view>
                  <view class="secondary-actions">
                    <view class="btn-ghost-sm" bindtap="saveDraft">
                      <text class="icon-save">ğŸ’¾</text>
                      <text>æš‚å­˜</text>
                    </view>
                    <view class="btn-primary-sm" bindtap="submitScore">
                      <text class="icon-sparkles">âœ¨</text>
                      <text>æäº¤è¯„åˆ†</text>
                    </view>
                  </view>
                </view>
              </view>
            </view>

            <!-- è¯„åˆ†å±•å¼€åŒºåŸŸ -->
            <view class="score-section {{showScore ? 'expanded' : ''}}" wx:if="{{showScore}}">
              <view class="score-header">
                <view class="total-score-box">
                  <text class="score-num">{{scoreData.total}}</text>
                  <text class="score-label">æ€»åˆ†</text>
                </view>
                <view class="radar-placeholder">
                  <!-- è¿™é‡Œå¯ä»¥ç”¨ç®€å•çš„è¿›åº¦æ¡æ¨¡æ‹Ÿé›·è¾¾å›¾çš„5ä¸ªç»´åº¦ -->
                  <view class="dimension-item" wx:for="{{scoreData.details}}" wx:key="name">
                    <text class="dim-name">{{item.name}}</text>
                    <view class="dim-bar-bg">
                      <view class="dim-bar-fill" style="width: {{(item.score/item.max)*100}}%"></view>
                    </view>
                    <text class="dim-score">{{item.score}}/{{item.max}}</text>
                  </view>
                </view>
              </view>

              <view class="comparison-section">
                <view class="compare-card user-card">
                  <view class="card-title">ä½ çš„è¡¨è¾¾</view>
                  <view class="card-text">{{currentParagraph}}</view>
                </view>
                <view class="compare-card ai-card">
                  <view class="card-title">AI ä¼˜åŒ–ç‰ˆ <text class="boost-tag">{{scoreData.rewrite.scoreBoost}}</text></view>
                  <view class="card-text">{{scoreData.rewrite.rewritten}}</view>
                </view>
              </view>

              <view class="recommended-materials-section">
                <view class="section-title">æ¨èç´ æ</view>
                <view class="material-tags">
                  <view 
                    class="material-tag" 
                    wx:for="{{scoreData.materials}}" 
                    wx:key="id"
                    bindtap="onMaterialClick"
                    data-item="{{item}}"
                  >
                    <text class="tag-type">[{{item.type}}]</text>
                    <text class="tag-content">{{item.content}}</text>
                  </view>
                </view>
              </view>

              <view class="collapse-btn" bindtap="collapseReview">
                <text>æ”¶èµ·ç‚¹è¯„</text>
                <text class="icon-up">â†‘</text>
              </view>
            </view>
          </view>
        </view>
      </main>
    </view>
  </view>

  <!-- ç´ æè¯¦æƒ…å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showMaterialModal}}" bindtap="closeMaterialModal">
    <view class="material-modal" catchtap="true">
      <view class="modal-header">
        <text class="modal-title">{{selectedMaterial.type}}è¯¦æƒ…</text>
        <view class="close-icon" bindtap="closeMaterialModal">Ã—</view>
      </view>
      <view class="modal-body">
        <view class="material-main-content">{{selectedMaterial.content}}</view>
        <view class="material-detail-text" wx:if="{{selectedMaterial.detail}}">
          <text class="detail-label">è§£æï¼š</text>
          <text>{{selectedMaterial.detail}}</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn-copy" bindtap="copyMaterial">å¤åˆ¶ç´ æ</button>
      </view>
    </view>
  </view>
</view>
