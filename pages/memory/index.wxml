<view class="container">
  <!-- ä¾§è¾¹å¯¼èˆªæ  -->
  <sidebar-nav activeNav="èƒŒè¯µæœ¬" userAvatar="{{userAvatar}}"></sidebar-nav>

  <!-- ä¸»å†…å®¹åŒº -->
  <view class="main-content">
    <!-- Header -->
    <view class="header">
      <view class="header-left">
        <text class="title">æ¯æ—¥èƒŒè¯µ</text>
        <text class="subtitle">æŒ‰è®°å¿†æ›²çº¿å¤ä¹ ä½ çš„ç´ æåº“ã€‚ä»Šæ—¥å¾…èƒŒï¼š{{totalCount}} æ¡ã€‚</text>
      </view>
      <view class="header-right">
        <view class="progress-stats">
          <text class="stats-label">å½“å‰è¿›åº¦</text>
          <text class="stats-value">{{currentIndex + 1}} / {{totalCount}}</text>
        </view>
        <view class="divider"></view>
        <view class="refresh-btn" bindtap="refreshCurve">
          <text class="refresh-icon">ğŸ”„</text>
          <text>åˆ·æ–°æ›²çº¿</text>
        </view>
      </view>
    </view>

    <!-- Progress Dots (Moved here) -->
    <view class="progress-dots-wrapper">
      <view 
        class="dot-pill {{index <= currentIndex ? 'active' : ''}}" 
        wx:for="{{progressDots}}" 
        wx:key="*this"
      ></view>
    </view>

    <!-- Card Area -->
    <view class="card-container">
      <!-- Flashcard -->
      <view class="flashcard {{isFlipped ? 'flipped' : ''}}" bindtap="toggleFlip">
        <view class="card-inner">
          <!-- Front Side -->
          <view class="card-face card-front">
            <view class="card-top">
              <view class="badge-black">{{currentMaterial.type}}</view>
              <text class="topic-text">è¯é¢˜ï¼š{{currentMaterial.topic}}</text>
            </view>
            
            <view class="card-center">
              <view class="content-wrapper" style="font-size: {{currentMaterial.fontSize}}px;">
                <block wx:for="{{currentMaterial.segments}}" wx:key="index">
                  <text class="serif-text" wx:if="{{!item.isHidden}}">{{item.text}}</text>
                  <view class="occlusion-block {{peek ? 'revealed' : ''}}" wx:else>
                    <text class="occlusion-text">{{item.text}}</text>
                  </view>
                </block>
              </view>
              
              <view class="eye-btn" catchtouchstart="onPeekStart" catchtouchend="onPeekEnd">
                <text class="eye-icon">ğŸ‘ï¸</text>
              </view>
            </view>

            <view class="card-bottom">
              <text class="hint-text">ç‚¹å‡»ç¿»è½¬æŸ¥çœ‹åŸæ–‡</text>
            </view>
          </view>

          <!-- Back Side -->
          <view class="card-face card-back">
            <view class="card-top">
              <view class="badge-white">ç­”æ¡ˆ</view>
              <text class="sparkle-icon">âœ¨</text>
            </view>

            <view class="card-center-back">
              <text class="serif-text-white">{{currentMaterial.backText}}</text>
              <view class="usage-box">
                <text class="usage-label">ä½¿ç”¨å»ºè®®</text>
                <text class="usage-text">{{currentMaterial.usageTip}}</text>
              </view>
            </view>

            <view class="card-actions">
              <view class="action-btn btn-outline" catchtap="onNotRemembered">
                <text class="btn-icon">âŒ</text>
                <text>è¿˜æ²¡è®°ä½</text>
              </view>
              <view class="action-btn btn-white" catchtap="onMastered">
                <text class="btn-icon">âœ…</text>
                <text>å·²ç»æŒæ¡</text>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- Nav Arrows -->
      <view class="nav-arrows">
        <view class="arrow-btn" bindtap="onPrev">
          <text class="arrow-icon">ã€ˆ</text>
        </view>
        <view class="arrow-btn" bindtap="onNext">
          <text class="arrow-icon">ã€‰</text>
        </view>
      </view>
    </view>
  </view>
</view>
