
---

## 4. 功能与交互（按页面）

### 4.1 首页 / 探索页

**目标**：刷热点 + 把素材收入库。  

- 内容：  
  - 若干热点话题卡片（乡村振兴、科技创新等）。  
  - 每个话题下列出 3–6 条精选素材（简短标题+类型）。  

- 每条素材支持：  
  - 「查看素材」  
    - 跳转：`/pages/materials/index?topic=xxx`  
    - 在素材库按 policyDirection/宏观字段过滤。  
  - 「加入素材库」  
    - 调用 `addMaterialFromHot` 云函数写入 materials：  
      - 自动填 type/title/content/source/sourceDate。  
      - AI 分类填 macroField/policyDirection/subDirection。  

- 不出现 DIY 按钮。

### 4.2 素材库页

**目标**：查看和管理素材（展示/搜索/改标签/新建），不选本次写作素材。  

- 顶部过滤：  
  - 领域（macroField）  
  - 政策方向（policyDirection）  
  - 分论点方向（subDirection）  
  - 类型（案例/数据/金句/政策）  
  - 时效（全部/3 个月内/6 个月内/仅长期有效）  

- 列表卡片：  
  - 标题 + 类型 + 三维标签。  
  - 底部小字：「来源｜日期｜状态」  
    - 示例：`来源：人民日报｜日期：2024-10-12｜状态：常用但略旧`  
  - 操作：  
    - 「编辑标签」：修改三维标签（只影响此素材，并调整关联 viewpoint）。  
    - 「编辑内容」：修改 title/content。  

- 新建素材：  
  - 「+ 新建素材」按钮 → 表单：type + title + content + source + sourceDate + 三维标签。  

- 不再有“勾选→去 DIY”。

### 4.3 观点库页

**目标**：从“话题/分论点”视角反向找素材。  

- 顶部 Tab：按领域/按政策/按分论点 3 种视图（仅排序和分组区别）。  
- 列表：  
  - 如按领域视图：  
    - 民生 → 乡村振兴 → [产业兴旺/生态宜居/治理有效…]  
  - 每个分论点行显示：  
    - subPointSentence（示例句）  
    - 素材数量 `N`  

- 操作：  
  - 点击分论点：跳到素材库，并带上该三维标签过滤。  
  - 「编辑标签」：调整此 viewpoint 的三维标签，并通过云函数批量同步所有关联素材的标签。  

- 不新增/删除 viewpoint，仅编辑标签。

### 4.4 DIY 生成器页

**目标**：在一个页面中完成：选素材 → 写分论点 → 生成单段。  

- 入口：  
  - 底部 Tab “DIY”；  
  - 观点库/素材详情里的“开始 DIY”按钮。  

- 上半部分：  
  - 分论点输入框。  
  - 骨架按钮【骨架】：  
    - 弹出抽屉展示该标签对应的骨架：  
      - 分论点句示例；  
      - 1–3 条论证方式骨架；  
      - 回扣句；  
    - 用户勾选若干条作为 `skeletonHint`，只做提示，不入库。  

- 中间：4 槽位  
  - 论点 / 金句 / 案例 / 数据。  
  - 点击任何槽位 → 打开“素材选择面板”：  
    - 类似迷你素材库：按 type 和三维标签过滤。  
    - 单选或多选后，填入槽位。  

- 下半部分：  
  - 【生成段落】按钮：  
    - 调用 `generateParagraph` 云函数（DeepSeek V3.2）。  
    - 传入：subPointText + 每个槽位的内容 + skeletonHint + 三维标签。  
  - 结果展示区：  
    - 文本框展示 200–250 字单段。  
    - 按钮：复制文本；把其中金句加入背诵本。  

- 云端逻辑：  
  - 成功生成后，对用到的素材更新：  
    - diyCount +=1；lastUsedAt=当前时间。

### 4.5 我的 & 背诵本

**我的页**：  
- 显示今日 DIY 次数、本周练习话题数。  
- 入口：「背诵本」。  

**背诵本**：  
- 列表视图：所有 `isMemorized=true` 的金句/短数据，按 nextReviewAt 排序。  
- 背诵模式：  
  - 一条一条出现待复习素材。  
  - 按钮：「忘了 / 模糊 / 背会了」，对应记忆等级 1/2/3 和复习间隔 1/2/7 天。  
  - 「用这句去写」→ 跳到 DIY 页，并预选该素材为金句槽位。

---

## 5. 规则与约束

### 5.1 素材时效规则

- 金句/理论：不自动过期，expireStatus 永远 active。  
- 案例/数据：  
  - sourceDate 超过 90 天且 diyCount <3 → expired。  
  - 超过 90 天且 diyCount ≥3 → old_but_hot。  
- 政策类：  
  - sourceDate 超过 180 天相同逻辑。  
- 定时云函数 `expireMaterials` 每周更新 expireStatus。

### 5.2 素材库上限

- MAX_MATERIALS = 300 条。  
- 插入新素材时：  
  - 若 total < 300：直接入库。  
  - 若 total ≥ 300：  
    - 清理部分 `expireStatus='expired'` 且 diyCount=0 的素材，按 lastUsedAt 最早优先；  
    - 清理到 240 条左右再插入。  
    - 如无法清理，仍插入但返回 needClean=true 给前端提醒。

### 5.3 来源合规约束

- sourceType='official'：仅用于官方公开站点内容（人民日报/新华社/政府网站等），可用爬虫抓事实数据。  
- sourceType='derived'：由他人内容“学习后重写”的原创表述，不保存原文。  
- sourceType='user'：用户或你手动录入。  

爬虫只用于 official，培训机构/教材内容只做 derived（重写）。

---

## 6. 技术与验收

### 6.1 技术栈

- 微信小程序原生 + 云开发。  
- 云函数：Node.js + wx-server-sdk。  
- 模型：DeepSeek V3.2 chat-completions。

### 6.2 关键验收点

- 能在首页将至少 10 条热点素材【加入素材库】，在素材库中可看到正确来源+日期+状态。  
- 能在观点库选择一个分论点，跳到素材库并看到对应标签过滤。  
- 能在 DIY 中通过素材选择面板选 3–4 条素材，生成一段 200–250 字的申论式分论点段落，并成功复制。  
- 背诵本正常记忆 10 条金句，复习按钮能正确更新下次时间。

